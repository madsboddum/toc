plugins {
    id 'groovy'
	id 'application'
}

group 'dk.madsboddum'
version '0.0.1'

repositories {
    mavenCentral()
}

dependencies {
	compile 'org.codehaus.groovy:groovy-all:3.0.3'
	
	// https://mvnrepository.com/artifact/commons-cli/commons-cli
	compile group: 'commons-cli', name: 'commons-cli', version: '1.4'
	
	testImplementation 'org.junit.jupiter:junit-jupiter-api:5.1.1'
	testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.1.1'
}

test {
	useJUnitPlatform()
}

def jarFile = project.name + ".jar"

jar {
	// Write app version to version.properties
	def properties = new Properties()
	properties.setProperty("version", version)
	properties.store(new FileOutputStream("src/main/resources/version.properties"), "This file is autogenerated by Gradle")
	
	manifest {
		attributes 'Main-Class': 'dk.madsboddum.toc.Application'
	}
	
	from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
	
	archiveFileName.set(jarFile)
}


task distribute(type: Zip) {
	dependsOn 'jar'
	
	// Copy the shell script into the libs folder so it'll be included in the zip file
	copy {
		from file("toc.sh")
		into file("$buildDir/libs/")
	}
	
	// Create a zip file. Example: toc-0.0.1.zip
	from 'build/libs'
	include '**/*'
	archiveName = project.name + "-" + version + ".zip"
	destinationDir(file('.'))
}
